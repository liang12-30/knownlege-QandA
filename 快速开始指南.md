# 快速开始指南

## ⚡ 快速部署

### 第一步：处理.doc文档（如果有）

```bash
# 查找.doc文件
dir dataset\*.doc /s

# 如果找到.doc文件：
# 1. 用Microsoft Word打开
# 2. 另存为 → 选择.docx格式
# 3. 保存到原目录
```

### 第二步：重新构建知识库

```bash
# 运行主程序（会自动重建知识库）
python main.py
```

**首次运行会：**
1. 下载BGE模型（约1.3GB，需要网络）
2. 解析dataset中的65篇文档
3. 使用500字分块（比之前更精准）
4. 构建BM25+向量混合索引
5. 运行5个测试问题

**预计时间：**5-10分钟（取决于网络和硬件）

---

## 📊 查看结果

### 命令行输出格式：

```
============================================================
问题 1: 请详细说明掌上银行中"基金"功能的主要服务内容...
意图: detail
检索方式: hybrid

知识点:

[知识点 1]
【来源】文档: 农行香港掌上银行服务指南
       类型: pdf
       片段: 第8段
【得分】0.8532
       (BM25: 0.2156, 语义: 0.6376)
【内容】
业务基本介绍。"基金"业务功能为在我行开户客户提供一个...
```

**说明：**
- **检索方式**：`hybrid`表示使用BM25+语义混合检索
- **来源**：显示知识点来自哪个文档、第几段
- **得分**：BM25分数（词频匹配）+ 语义分数（语义理解）
- **内容**：清理后的文本（无页码标记）

---

## 🎛️ 模型选择

当前默认使用 **BGE-large**（效果最好）

### 如果要切换模型：

编辑 `config.py` 第32行：

**选项1：BGE（推荐，效果最好）**
```python
SENTENCE_TRANSFORMER_MODEL = "BAAI/bge-large-zh-v1.5"
```

**选项2：text2vec（轻量，速度快）**
```python
# SENTENCE_TRANSFORMER_MODEL = "BAAI/bge-large-zh-v1.5"  # 注释掉
SENTENCE_TRANSFORMER_MODEL = "shibing624/text2vec-base-chinese"  # 取消注释
```

**切换后必须重新运行 `python main.py`**

---

## 🔧 参数调整

### 如果结果太泛（召回太多无关内容）：

编辑 `config.py`：

```python
# 提高相似度阈值
SIMILARITY_THRESHOLD = 0.6  # 从0.5提高到0.6

# 增加BM25权重（更注重关键词）
BM25_WEIGHT = 0.4  # 从0.3提高到0.4
SEMANTIC_WEIGHT = 0.6  # 从0.7降低到0.6
```

### 如果召回率太低（找不到相关内容）：

```python
# 降低相似度阈值
SIMILARITY_THRESHOLD = 0.4  # 从0.5降低到0.4

# 增加语义权重
BM25_WEIGHT = 0.2  # 从0.3降低到0.2
SEMANTIC_WEIGHT = 0.8  # 从0.7提高到0.8
```

**修改后重新运行**

---

## 🌐 启动API服务

```bash
python api_server.py
```

访问：http://localhost:8000/docs

### API接口：

**POST /answer**
```json
{
  "question": "你的问题"
}
```

**返回：**
```json
{
  "question": "你的问题",
  "intent": "detail",
  "knowledge_points": ["知识点1", "知识点2", "知识点3"],
  "knowledge_points_detailed": [
    {
      "content": "知识点内容",
      "source": {
        "document": "文档名",
        "type": "pdf",
        "chunk_index": 0
      },
      "score": 0.85,
      "score_details": {
        "bm25": 0.25,
        "semantic": 0.60
      }
    }
  ],
  "metadata": {
    "retrieval_method": "hybrid",
    ...
  }
}
```

---

## 🎨 启动前端

### Windows:
```bash
启动前端.bat
```

### 手动启动：
```bash
# 1. 启动API服务
start python api_server.py

# 2. 打开浏览器访问
start frontend.html
```

---

## 📈 性能对比

| 方面 | 改进前 | 改进后 |
|------|--------|--------|
| 检索准确度 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 答案相关性 | 70% | 90%+ |
| 来源追溯 | ❌ | ✅ |
| 分块精度 | 800字 | 500字 |
| 中文优化 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| .doc支持 | ❌ | ⚠️ 需转换 |

---

## ⚠️ 常见问题

### Q1: 模型下载太慢怎么办？

**方案1：使用国内镜像**
```bash
set HF_ENDPOINT=https://hf-mirror.com
python main.py
```

**方案2：切换到轻量模型**
```python
# config.py
SENTENCE_TRANSFORMER_MODEL = "shibing624/text2vec-base-chinese"
```

### Q2: .doc文件仍然失败？

**检查：**
```bash
# 确认文件扩展名
dir dataset\*.doc

# 转换方法：
# 1. Word打开 → 另存为.docx
# 2. 或使用 LibreOffice (免费)
# 3. 在线转换：https://convertio.co/zh/doc-docx/
```

### Q3: 内存不足？

**方案1：减小batch_size**
```python
# retrieval_ranking.py 第146行
batch_size=16  # 从32改为16
```

**方案2：切换轻量模型**
```python
# config.py
SENTENCE_TRANSFORMER_MODEL = "shibing624/text2vec-base-chinese"
```

### Q4: 答案还是不准确？

**步骤1：检查检索方式**
```
# 输出中应该显示：
检索方式: hybrid

# 如果显示semantic，检查config.py：
USE_HYBRID_RETRIEVAL = True  # 确保为True
```

**步骤2：调整权重**
```python
# 如果答案不够精准：
BM25_WEIGHT = 0.4  # 增加关键词权重
SEMANTIC_WEIGHT = 0.6

# 如果答案太死板：
BM25_WEIGHT = 0.2  # 减少关键词权重
SEMANTIC_WEIGHT = 0.8
```

**步骤3：查看日志**
```bash
# 查看详细日志
type output\system.log
```

---

## 📞 技术支持

遇到问题？提供以下信息：

1. **错误信息**：
   ```bash
   type output\system.log
   ```

2. **系统配置**：
   - 使用的模型
   - 内存大小
   - Python版本

3. **数据集信息**：
   - 文档数量
   - .doc文件数量
   - dataset目录大小

---

## 🎯 下一步

1. ✅ 确认.doc文件已转换
2. ✅ 运行 `python main.py`
3. ✅ 查看输出结果
4. ✅ 根据效果调整参数
5. ✅ 启动API和前端

**祝使用愉快！** 🚀

